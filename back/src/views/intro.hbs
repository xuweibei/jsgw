<link rel="stylesheet" href="../assets/css/intro.css">
{{#>default}}
<div class="intro-container">
    <div class="intro-title border-bottom">
        <div class="float-left font-weight-bolder intro">公司简介</div>
        <div class="float-right d-flex justify-content-between">
            <div class="show-home font-weight-bold">展示在首页</div>
            <button class="btn text-white border-0 intro-edit" onclick="change()">编辑</button>
        </div>
    </div>
    <div class="intro-desc">
        {{!-- <div class="intro-desc">
            这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容
            这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容这里是正文内容
        </div> --}}
        {{!-- <div class="intro-img-container text-center">
            <img src="../assets/img/login-bg.png" alt="">
        </div> --}}
        <div id="ht"></div>
    </div>
    <div class="editor position-fixed">
        <div id="editor" style="width: 1200px;">
        </div>
        <button class="btn btn-primary btn-edit" onclick="saveHtml()">保存</button>
    </div>
</div>

<script type="text/javascript" type="module">
    var edit = document.getElementsByClassName('intro-edit')[0];
    var desc = document.getElementsByClassName('intro-desc')[0];
    var home = document.getElementsByClassName('show-home')[0];
    var editor = document.getElementsByClassName('editor')[0];
    var E = window.wangEditor;
    var editor = new E('#editor');
    editor.customConfig = {
        uploadImgMaxSize: 2 * 1024 * 1024,
        uploadFileName: 'mypic',
        uploadImgMaxLength: 10,
        debug: true,//开启debug调试
    }

    editor.customConfig.customUploadImg = function (files, insert) {
        var formData = new FormData();
        for (var i = 0; i < files.length; i++) {
            formData.append("files[" + i + "]", files[i], files[i].name);
        }
        $.ajax({
            url: url.submitIntro,
            type: "POST",
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success: function (res) {
                if (res.status == 0) {
                    res.data.forEach(item => {
                        insert(item)
                    })
                }
            }
        });
    };
    editor.create();
    // 显示富文本
    function change() {
        edit.classList.add('d-none');
        desc.classList.add('d-none');
        home.classList.add('d-none');
    }

    // 上传富文本
    function saveHtml() {
        var html = editor.txt.html();
        var filterHtml = filterXSS(html);
        $.post(url.insertIntro, {html}, function(res) {
            if (res && res.status === 0) {
                location.reload()
            }
        })
    }
    // 获取页面渲染元素
    function getHtml() {
        $.post(url.renderHtml, function(res) {
            if (res && res.status === 0) {
                $('#ht').html(res.data.html);
            }
        })
    }
    getHtml();
</script>
{{/default}}