{{#>default}}
{{!-- <link rel="stylesheet" href="../assets/styles/fileinput.min.css">
<script src="../assets/js/fileinput.min.js"></script> --}}
<div class="job-class-container products-center-container">
  <div class="job-class-top">
    <div class="card-body-title">
      产品中心
    </div>
    <div class="card-body-btn d-flex" style="line-height: 32px;">
      <div class="form-check" style="margin-right: 30px;">
        <input class="form-check-input" type="checkbox" id="defaultCheck1" style="margin-top: 11px;">
        <label class="form-check-label show-home" style="color: #0AAFDE" for="defaultCheck1">
          展示在首页
        </label>
      </div>
      <button type="button" class="btn" data-toggle="modal" data-target="#addModal">新增</button>
    </div>
  </div>
  <div>

  </div>
  <div class="table-container">
    <table id="table" class="text-center table table-striped table-borderless" data-pagination="true">
      <thead>
        <tr>
          {{!-- <th data-field="id">ID</th>
          <th data-field="serial_number">Item Name</th>
          <th data-field="pro_name">Item Price</th> --}}
        </tr>
      </thead>
    </table>
    <script>

      $('.form-check-input').on('change', function () {
        let show = $("input[type='checkbox']").is(':checked') ? "1" : "0";
        $.post(url.changeModuleStatus, { status: show, id: 7 }, function (res) {
          if (res && res.status === 0) {
            console.log('修改成功')
          }
        })
      })

      function getChecked() {
        $.get(url.getChecked, { id: 7 }, function (res) {
          if (res && res.status === 0) {
            $('.form-check-input').attr('checked', res.data.checked)
          }
        })
      }
      getChecked()

      var $table = $('#table')
      $(function () {
        $table.bootstrapTable({
          toolbar: '.toolbar',
          method: "get",
          url: url.getProducts,
          pageNumber: 1,
          pagination: true,
          sortable: true,
          sortOrder: "asc",
          //queryParams: { a: 1 },
          pageSize: 10,
          paginationPreText: "上一页",
          paginationNextText: "下一页",
          pageList: [5, 10, 15, 20, 25],
          formatLoadingMessage: function () {
            return "请稍等，正在加载中...";
          },
          responseHandler: function (res) {
            return res.data
          },
          columns: [{
            title: '编号',
            field: 'serial_number'
          }, {
            title: '产品名称',
            field: 'pro_name'
          }, {
            title: '操作',
            field: 'opt',
            formatter: operateFormatter,
            events: operateEvent = {
              /*"click .btn-modify": function (e, value, row, index) {
                e.preventDefault();
              },*/
              "click .btn-remove": function (e, value, row, index) {
                e.preventDefault();
                $.post(url.delProduct, { id: row.id }, function (res) {
                  if (res && res.status === 0) {
                    location.reload()
                  }
                })
              },
              "click .btn-preview": function (e, value, row, index) {
                e.preventDefault();
                $.post(url.previewProduct, { id: row.id }, function (res) {
                  if (res && res.status === 0) {
                    console.log(res)
                  }
                })
              },
              "click .btn-show": function (e, value, row, index) {
                e.preventDefault();
                const status = row.status === '1' ? '0' : '1'
                $.post(url.showItem, { status, id: row.id }, function (res) {
                  if (res && res.status === 0) {
                    location.reload()
                  }
                })
              }
            }
          }]
        })
        function operateFormatter(value, row, index) {
          return [
            row.status === '1' ? '<a class="btn-modify like opt" href="javascript:void(0)" title="Like" data-toggle="modal" data-target="#modifyModal">修改 </a>' : '',
            row.status === '1' ? '<a class="btn-remove remove opt" href="javascript:void(0)" title="Remove">删除</a>' : '',
            '<a class="btn-preview opt" href="javascript:void(0)" title="Remove" data-toggle="modal" data-target="#previewModal">预览 </a>',
            `<a class="btn-show like opt" href="javascript:void(0)" title="Remove">${row.status === '1' ? '展示' : '停止展示'}</a>`
          ].join('')
        }
      })
    </script>
  </div>
</div>
{{!-- 提示框 --}}
<div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="toast-header">
    {{!-- <img src="..." class="rounded mr-2" alt="..."> --}}
    {{!-- <strong class="mr-auto">Bootstrap</strong> --}}
    {{!-- <small>11 mins ago</small> --}}
    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="toast-body">
    成功
  </div>
</div>
{{!-- 新增弹出框 --}}
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        {{!-- <h5 class="modal-title" id="exampleModalLabel">New message</h5> --}}
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group d-flex justify-content-start">
            <label for="recipient-name" class="col-form-label">产品名称：</label>
            <div>
              <input type="text" placeholder="中卖网" class="form-control" id="recipient-name" />
            </div>
          </div>
          <div class="form-group d-flex justify-content-start">
            <label for="message-text" class="col-form-label">简介：</label>
            <div>
              <textarea class="form-control" placeholder="优质商品，快乐选购" id="message-text"></textarea>
            </div>
          </div>
          <div class="form-group d-flex justify-content-start">
            <label for="serial-number" class="col-form-label">产品编号：</label>
            <div>
              <input type="text" class="form-control" id="serial-number" />
            </div>
          </div>
          <div class="form-group product-logo d-flex justify-content-start align-items-center">
            <label class="control-label">产品logo：</label>
            <div class="product-logo-container">
              <input id="dawnload-logo" type="file" />
            </div>
          </div>
          <div class="form-group product-code d-flex justify-content-start align-items-center">
            <label class="control-label">下载方式：</label>
            <div class="product-code-container">
              <input id="dawnload-way" type="file" />
            </div>
          </div>
          <div class="form-group d-flex justify-content-start align-items-center">
            <label for="android-dawnload-address" class="col-form-label">安卓下载地址：</label>
            <div>
              <input id="android-dawnload-address" class="form-control" type="text" />
            </div>
          </div>
          <div class="form-group d-flex justify-content-start align-items-center">
            <label for="ios-dawnload-address" class="col-form-label">IOS下载地址：</label>
            <div>
              <input id="ios-dawnload-address" class="form-control" type="text" />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer text-center">
        {{!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> --}}
        <button type="button" class="btn btn-primary" onclick="commitNewProduct()">发布</button>
      </div>
    </div>
  </div>
</div>
{{!-- 修改弹窗 --}}
<div class="modal fade" id="modifyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        {{!-- <h5 class="modal-title" id="exampleModalLabel">New message</h5> --}}
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group d-flex justify-content-start">
            <label for="recipient-name" class="col-form-label">产品名称：</label>
            <div>
              <input type="text" placeholder="中卖网" class="form-control" id="recipient-name" />
            </div>
          </div>
          <div class="form-group d-flex justify-content-start">
            <label for="message-text" class="col-form-label">简介：</label>
            <div>
              <textarea class="form-control" placeholder="优质商品，快乐选购" id="message-text"></textarea>
            </div>
          </div>
          <div class="form-group d-flex justify-content-start">
            <label for="show-item" class="col-form-label">是否展示：</label>
            <div>
              <input type="text" placeholder="展示" class="form-control" id="show-item" />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">返回</button>
        <button type="button" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>
</div>
{{!-- 预览弹窗 --}}
<div class="modal fade" id="previewModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        {{!-- <h5 class="modal-title" id="exampleModalLabel">New message</h5> --}}
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div class="col-6">
              <span>产品名称：</span>
              <span class=""></span>
            </div>
            <div class="col-6">
              <span>简介：</span>
              <span></span>
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <p>产品logo：</p>
              <img src="" alt="">
            </div>
            <div class="col-6">
              <p>下载地址二维码：</p>
              <img src="" alt="">
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <span>下载地址：</span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">返回</button>
        {{!-- <button type="button" class="btn btn-primary">保存</button> --}}
      </div>
    </div>
  </div>
</div>
<script>
  //获取本地图片url
  function getObjectURL(file) {
    var url = null;
    if (window.createObjectURL != undefined) { // basic
      url = window.createObjectURL(file);
    } else if (window.URL != undefined) { // mozilla(firefox)
      url = window.URL.createObjectURL(file);
    } else if (window.webkitURL != undefined) { // webkit or chrome
      url = window.webkitURL.createObjectURL(file);
    }
    return url;
  }
  //封装的图片预览方法
  function getImg(selector, container) {
    $(selector).on('change', function (e) {
      const newImg = e.target.files[0]
      const imgUrl = getObjectURL(newImg)
      $(container).css({
        'background': `url(${getObjectURL(e.target.files[0])})`,
        'background-size': '100%'
      })
    })
  }
  getImg($('#dawnload-logo'), $('.product-logo-container'))
  getImg($('#dawnload-way'), $('.product-code-container'))
  //提交
  function commitNewProduct() {
    let formData = new FormData();
    const logo = $('#dawnload-logo')[0].files;
    const link_code = $('#dawnload-way')[0].files;
    const serial_number = $('#serial-number').val();
    const product_desc = $('#message-text').val();
    const pro_name = $('#recipient-name').val();
    const android_link = $('#android-dawnload-address').val();
    const ios_link = $('#ios-dawnload-address').val();
    formData.append('logo', logo[0], logo[0].name);
    formData.append('link_code', link_code[0], link_code[0].name);
    formData.append('serial_number', serial_number);
    formData.append('product_desc', product_desc);
    formData.append('pro_name', pro_name);
    formData.append('android_link', android_link);
    formData.append('ios_link', ios_link)
    $.ajax({
      url: url.newProduct,
      type: "POST",
      data: formData,
      async: false,
      cache: false,
      contentType: false,
      processData: false,
      success: function (res) {
        location.reload()
      }
    });
  }
</script>
<style>
  .form-group label {
    width: 120px;
    text-align: right;
  }

  .modal-footer .btn {
    width: 128px;
  }

  .form-group>div {
    width: 300px;
  }

  .product-logo-container input,
  .product-code-container input {
    width: 200px;
    height: 200px;
    border: 1px solid #eee;
    opacity: 0;
  }

  .form-group .product-logo-container,
  .form-group .product-code-container {
    border: 1px solid #eee;
    width: 200px;
    height: 200px;
  }
</style>
{{/default}}